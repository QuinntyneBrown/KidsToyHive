<!-- Copyright (c) Quinntyne Brown. All Rights Reserved. -->
<!-- Licensed under the MIT License. See License.txt in the project root for license information. -->

<div class="dashboard">
  <!-- Welcome Section -->
  <div class="dashboard__welcome-section" *ngIf="currentUser$ | async as user">
    <h1 class="dashboard__title">Welcome back, {{ user.name }}!</h1>
    <p class="dashboard__subtitle">Here's what's happening with your business today.</p>
  </div>

  <!-- Error State -->
  <mat-card *ngIf="hasError()" class="dashboard__error-card">
    <mat-card-content>
      <div class="dashboard__error-content">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ errorMessage() }}</p>
        <button mat-raised-button color="primary" (click)="onRetry()">
          <mat-icon>refresh</mat-icon>
          Retry
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Metrics Cards -->
  <div class="dashboard__metrics-grid">
    <!-- Total Bookings -->
    <mat-card class="dashboard__metric-card">
      <mat-card-content>
        <div class="dashboard__metric-content" *ngIf="!isLoadingMetrics() && metrics(); else loadingSkeleton">
          <div class="dashboard__metric-icon dashboard__metric-icon--bookings">
            <mat-icon>event</mat-icon>
          </div>
          <div class="dashboard__metric-details">
            <div class="dashboard__metric-value">{{ metrics()?.totalBookings || 0 }}</div>
            <div class="dashboard__metric-label">Total Bookings</div>
            <div class="dashboard__metric-period">This month</div>
          </div>
        </div>
        <ng-template #loadingSkeleton>
          <div class="dashboard__skeleton-loader">
            <mat-spinner diameter="40"></mat-spinner>
          </div>
        </ng-template>
      </mat-card-content>
    </mat-card>

    <!-- Active Customers -->
    <mat-card class="dashboard__metric-card">
      <mat-card-content>
        <div class="dashboard__metric-content" *ngIf="!isLoadingMetrics() && metrics(); else loadingSkeleton">
          <div class="dashboard__metric-icon dashboard__metric-icon--customers">
            <mat-icon>people</mat-icon>
          </div>
          <div class="dashboard__metric-details">
            <div class="dashboard__metric-value">{{ metrics()?.activeCustomers || 0 }}</div>
            <div class="dashboard__metric-label">Active Customers</div>
            <div class="dashboard__metric-period">Current</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Pending Orders -->
    <mat-card class="dashboard__metric-card">
      <mat-card-content>
        <div class="dashboard__metric-content" *ngIf="!isLoadingMetrics() && metrics(); else loadingSkeleton">
          <div class="dashboard__metric-icon dashboard__metric-icon--orders">
            <mat-icon>shopping_cart</mat-icon>
          </div>
          <div class="dashboard__metric-details">
            <div class="dashboard__metric-value">{{ metrics()?.pendingOrders || 0 }}</div>
            <div class="dashboard__metric-label">Pending Orders</div>
            <div class="dashboard__metric-period">To process</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Revenue -->
    <mat-card class="dashboard__metric-card">
      <mat-card-content>
        <div class="dashboard__metric-content" *ngIf="!isLoadingMetrics() && metrics(); else loadingSkeleton">
          <div class="dashboard__metric-icon dashboard__metric-icon--revenue">
            <mat-icon>attach_money</mat-icon>
          </div>
          <div class="dashboard__metric-details">
            <div class="dashboard__metric-value">{{ formatCurrency(metrics()?.revenue || 0) }}</div>
            <div class="dashboard__metric-label">Revenue</div>
            <div class="dashboard__metric-period">This month</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Quick Actions -->
  <mat-card class="dashboard__quick-actions-card">
    <mat-card-header>
      <mat-card-title>Quick Actions</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="quick-actions">
        <button mat-raised-button color="primary" (click)="onCreateBooking()">
          <mat-icon>add</mat-icon>
          Create Booking
        </button>
        <button mat-raised-button color="primary" (click)="onAddCustomer()">
          <mat-icon>person_add</mat-icon>
          Add Customer
        </button>
        <button mat-raised-button color="primary" (click)="onProcessOrder()">
          <mat-icon>shopping_bag</mat-icon>
          Process Order
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Content Grid -->
  <div class="content-grid">
    <!-- Recent Activity -->
    <mat-card class="activity-card">
      <mat-card-header>
        <mat-card-title>Recent Activity</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="isLoadingActivity()" class="loading-state">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        
        <mat-list *ngIf="!isLoadingActivity() && recentActivity().length > 0">
          <mat-list-item *ngFor="let item of recentActivity(); let last = last">
            <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
            <div matListItemTitle>{{ item.title }}</div>
            <div matListItemLine>{{ item.description }}</div>
            <span matListItemMeta class="activity-time">{{ formatRelativeTime(item.timestamp) }}</span>
            <mat-divider *ngIf="!last"></mat-divider>
          </mat-list-item>
        </mat-list>
        
        <div *ngIf="!isLoadingActivity() && recentActivity().length === 0" class="empty-state">
          <mat-icon>inbox</mat-icon>
          <p>No recent activity</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Upcoming Bookings -->
    <mat-card class="bookings-card">
      <mat-card-header>
        <mat-card-title>Upcoming Bookings</mat-card-title>
        <mat-card-subtitle>Next 7 days</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="isLoadingBookings()" class="loading-state">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        
        <mat-list *ngIf="!isLoadingBookings() && upcomingBookings().length > 0">
          <mat-list-item *ngFor="let booking of upcomingBookings(); let last = last">
            <mat-icon matListItemIcon>event</mat-icon>
            <div matListItemTitle>{{ booking.customerName }}</div>
            <div matListItemLine>{{ formatDate(booking.date) }} â€¢ {{ booking.totalItems }} items</div>
            <span matListItemMeta [class]="'status-badge ' + booking.status.toLowerCase()">
              {{ booking.status }}
            </span>
            <mat-divider *ngIf="!last"></mat-divider>
          </mat-list-item>
        </mat-list>
        
        <div *ngIf="!isLoadingBookings() && upcomingBookings().length === 0" class="empty-state">
          <mat-icon>event_available</mat-icon>
          <p>No upcoming bookings</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

