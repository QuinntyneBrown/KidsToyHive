{"ast":null,"code":"var _a;\nimport { __decorate, __metadata } from \"tslib\";\n// Copyright (c) Quinntyne Brown. All Rights Reserved.\n// Licensed under the MIT License. See License.txt in the project root for license information.\nimport { Component } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { BookingService, AuthService } from '../../../../../core';\nimport { LocalStorageService, accessTokenKey, bookingIdKey, isProblemDetails } from '../../../../../core';\nimport { Router, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree } from '@angular/router';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { takeUntil, map } from 'rxjs/operators';\nimport { YourOrderService } from '../../your-order.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../../core\";\nimport * as i2 from \"@angular/router\";\nexport let CreateBookingSectionGuard = /*#__PURE__*/(() => {\n  class CreateBookingSectionGuard {\n    constructor(_localStorageService, _router) {\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n    }\n    canActivate(route, state) {\n      const bookingId = this._localStorageService.get({\n        name: bookingIdKey\n      });\n      const token = this._localStorageService.get({\n        name: accessTokenKey\n      });\n      if (!token) return this._router.parseUrl('order/step/1');\n      if (bookingId) return this._router.parseUrl('order/step/3');\n      return true;\n    }\n    static {\n      this.ɵfac = function CreateBookingSectionGuard_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CreateBookingSectionGuard)(i0.ɵɵinject(i1.LocalStorageService), i0.ɵɵinject(i2.Router));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: CreateBookingSectionGuard,\n        factory: CreateBookingSectionGuard.ɵfac\n      });\n    }\n  }\n  return CreateBookingSectionGuard;\n})();\nlet CreateBookingSection = class CreateBookingSection {\n  get _productId() {\n    return this._localStorageService.get({\n      name: 'productId'\n    });\n  }\n  constructor(_bookingService, _localStorageService, _router, _authService, _yourOrderService) {\n    this._bookingService = _bookingService;\n    this._localStorageService = _localStorageService;\n    this._router = _router;\n    this._authService = _authService;\n    this._yourOrderService = _yourOrderService;\n    this.onDestroy = new Subject();\n    this.form = new FormGroup({\n      date: new FormControl(null, [Validators.required]),\n      bookingTimeSlot: new FormControl(null, [Validators.required]),\n      street: new FormControl(null, [Validators.required]),\n      city: new FormControl(null, [Validators.required]),\n      province: new FormControl(null, [Validators.required]),\n      postalCode: new FormControl(null, [Validators.required])\n    });\n    this.bookingTimeSlots = [{\n      value: 0,\n      name: 'Morning'\n    }, {\n      value: 1,\n      name: 'Afternoon'\n    }, {\n      value: 2,\n      name: 'Full Day'\n    }];\n  }\n  ngOnInit() {\n    this._yourOrderService.booking$.next({});\n    this._authService.isAuthenticatedChanged$.pipe(takeUntil(this.onDestroy), map(x => {\n      if (!x) {\n        this._router.navigateByUrl('order/step/1');\n      }\n    })).subscribe();\n  }\n  handleBookingTimeSlotChange() {\n    this._yourOrderService.bookingTimeSlot$.next(this.form.value.bookingTimeSlot);\n  }\n  handleBookingDateChange() {\n    this._yourOrderService.bookingDate$.next(this.form.value.date);\n  }\n  tryToCreateBooking(value) {\n    const booking = {\n      bookingDetails: [{\n        productId: this._productId,\n        quantity: 1\n      }],\n      date: value.date,\n      bookingTimeSlot: value.bookingTimeSlot,\n      location: {\n        address: {\n          street: value.street,\n          city: value.city,\n          province: value.province,\n          postalCode: value.postalCode\n        }\n      }\n    };\n    this._bookingService.create({\n      booking\n    }).pipe(takeUntil(this.onDestroy), map(x => {\n      if (isProblemDetails(x)) {\n        this.errorMessage = 'The Jungle Jumparro is unavaliable for the time and date you have selected';\n      } else {\n        this._localStorageService.put({\n          name: bookingIdKey,\n          value: x.bookingId\n        });\n        this._router.navigateByUrl('/order/step/3');\n      }\n    })).subscribe();\n  }\n  get date() {\n    return this.form.get('date');\n  }\n  get bookingTimeSlot() {\n    return this.form.get('bookingTimeSlot');\n  }\n  get street() {\n    return this.form.get('street');\n  }\n  get city() {\n    return this.form.get('city');\n  }\n  get province() {\n    return this.form.get('province');\n  }\n  get postalCode() {\n    return this.form.get('postalCode');\n  }\n  ngOnDestroy() {\n    this.onDestroy.next();\n  }\n};\nCreateBookingSection = __decorate([Component({\n  standalone: true,\n  templateUrl: './create-booking-section.html',\n  styleUrls: ['./create-booking-section.scss'],\n  selector: 'kth-create-booking-section'\n}), __metadata(\"design:paramtypes\", [BookingService, LocalStorageService, Router, AuthService, typeof (_a = typeof YourOrderService !== \"undefined\" && YourOrderService) === \"function\" ? _a : Object])], CreateBookingSection);\nexport { CreateBookingSection };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}