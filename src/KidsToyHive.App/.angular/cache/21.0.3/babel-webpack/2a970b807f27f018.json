{"ast":null,"code":"import { Subject } from 'rxjs';\nimport { BookingService, AuthService } from '../../../../../core';\nimport { LocalStorageService, accessTokenKey, bookingIdKey, productIdKey, isProblemDetails } from '../../../../../core';\nimport { Router, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree } from '@angular/router';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { takeUntil, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../../core\";\nimport * as i2 from \"@angular/router\";\nfunction ProcessBookingPayment_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 9);\n    i0.ɵɵtext(1, \" Credit Card Number is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction ProcessBookingPayment_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 9);\n    i0.ɵɵtext(1, \" Expiry Month is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction ProcessBookingPayment_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 9);\n    i0.ɵɵtext(1, \" Expiry Year is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction ProcessBookingPayment_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 9);\n    i0.ɵɵtext(1, \" Cvc is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction ProcessBookingPayment_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 10);\n    i0.ɵɵtext(1);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.errorMessage, \" \");\n  }\n}\nexport let ProcessPaymentSectionGuard = /*#__PURE__*/(() => {\n  class ProcessPaymentSectionGuard {\n    constructor(_localStorageService, _router) {\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n    }\n    canActivate(route, state) {\n      const bookingId = this._localStorageService.get({\n        name: 'bookingId'\n      });\n      const token = this._localStorageService.get({\n        name: accessTokenKey\n      });\n      if (!bookingId || !token) return this._router.parseUrl('order/step/2');\n      return true;\n    }\n    static {\n      this.ɵfac = function ProcessPaymentSectionGuard_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ProcessPaymentSectionGuard)(i0.ɵɵinject(i1.LocalStorageService), i0.ɵɵinject(i2.Router));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: ProcessPaymentSectionGuard,\n        factory: ProcessPaymentSectionGuard.ɵfac\n      });\n    }\n  }\n  return ProcessPaymentSectionGuard;\n})();\nexport let ProcessBookingPayment = /*#__PURE__*/(() => {\n  class ProcessBookingPayment {\n    constructor(_authService, _bookingService, _localStorageService, _router) {\n      this._authService = _authService;\n      this._bookingService = _bookingService;\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n      this.onDestroy = new Subject();\n      this.form = new FormGroup({\n        number: new FormControl(null, [Validators.required]),\n        expYear: new FormControl(null, [Validators.required]),\n        expMonth: new FormControl(null, [Validators.required]),\n        cvc: new FormControl(null, [Validators.required])\n      });\n    }\n    ngOnInit() {\n      this._authService.isAuthenticatedChanged$.pipe(takeUntil(this.onDestroy), map(x => {\n        if (!x) {\n          this._router.navigateByUrl('order/step/1');\n        }\n      })).subscribe();\n    }\n    ngOnDestroy() {\n      this.onDestroy.next();\n    }\n    tryToCheckout(formValue) {\n      const bookingId = this._localStorageService.get({\n        name: bookingIdKey\n      });\n      this._bookingService.processBookingPayment({\n        number: formValue.number,\n        expMonth: formValue.expMonth,\n        expYear: formValue.expYear,\n        cvc: formValue.cvc,\n        bookingId\n      }).pipe(takeUntil(this.onDestroy), map(x => {\n        if (isProblemDetails(x)) {\n          this.errorMessage = x.detail;\n        } else {\n          this._localStorageService.remove({\n            name: bookingIdKey\n          });\n          this._localStorageService.remove({\n            name: productIdKey\n          });\n          this._router.navigateByUrl('myprofile');\n        }\n      })).subscribe();\n    }\n    get number() {\n      return this.form.get('number');\n    }\n    get expMonth() {\n      return this.form.get('expMonth');\n    }\n    get expYear() {\n      return this.form.get('expYear');\n    }\n    get cvc() {\n      return this.form.get('cvc');\n    }\n    static {\n      this.ɵfac = function ProcessBookingPayment_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ProcessBookingPayment)(i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i1.BookingService), i0.ɵɵdirectiveInject(i1.LocalStorageService), i0.ɵɵdirectiveInject(i2.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProcessBookingPayment,\n        selectors: [[\"kth-process-booking-payment\"]],\n        decls: 25,\n        vars: 7,\n        consts: [[\"novalidate\", \"\", \"autocomplete\", \"off\", \"spellcheck\", \"false\", 3, \"formGroup\"], [1, \"field\"], [\"type\", \"text\", \"formControlName\", \"number\", 3, \"focus\"], [\"class\", \"field-error\", 4, \"ngIf\"], [\"type\", \"text\", \"formControlName\", \"expMonth\", 3, \"focus\"], [\"type\", \"text\", \"formControlName\", \"expYear\", 3, \"focus\"], [\"type\", \"text\", \"formControlName\", \"cvc\", 3, \"focus\"], [3, \"click\", \"text\"], [\"class\", \"error\", 4, \"ngIf\"], [1, \"field-error\"], [1, \"error\"]],\n        template: function ProcessBookingPayment_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵdomElementStart(0, \"h3\");\n            i0.ɵɵtext(1, \"Checkout\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(2, \"form\", 0)(3, \"div\", 1)(4, \"label\");\n            i0.ɵɵtext(5, \"Credit Card Number:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(6, \"input\", 2);\n            i0.ɵɵdomListener(\"focus\", function ProcessBookingPayment_Template_input_focus_6_listener() {\n              return ctx.errorMessage = \"\";\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(7, ProcessBookingPayment_div_7_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(8, \"div\", 1)(9, \"label\");\n            i0.ɵɵtext(10, \"Expiry Month:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(11, \"input\", 4);\n            i0.ɵɵdomListener(\"focus\", function ProcessBookingPayment_Template_input_focus_11_listener() {\n              return ctx.errorMessage = \"\";\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(12, ProcessBookingPayment_div_12_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(13, \"div\", 1)(14, \"label\");\n            i0.ɵɵtext(15, \"Expiry Year:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(16, \"input\", 5);\n            i0.ɵɵdomListener(\"focus\", function ProcessBookingPayment_Template_input_focus_16_listener() {\n              return ctx.errorMessage = \"\";\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(17, ProcessBookingPayment_div_17_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(18, \"div\", 1)(19, \"label\");\n            i0.ɵɵtext(20, \"Cvc:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(21, \"input\", 6);\n            i0.ɵɵdomListener(\"focus\", function ProcessBookingPayment_Template_input_focus_21_listener() {\n              return ctx.errorMessage = \"\";\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(22, ProcessBookingPayment_div_22_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(23, \"kth-button\", 7);\n            i0.ɵɵdomListener(\"click\", function ProcessBookingPayment_Template_kth_button_click_23_listener() {\n              return ctx.tryToCheckout(ctx.form.value);\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(24, ProcessBookingPayment_div_24_Template, 2, 1, \"div\", 8);\n            i0.ɵɵdomElementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(2);\n            i0.ɵɵdomProperty(\"formGroup\", ctx.form);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.number.errors && ctx.number.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.expMonth.errors && ctx.expMonth.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.expYear.errors && ctx.expYear.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.cvc.errors && ctx.cvc.errors.required);\n            i0.ɵɵadvance();\n            i0.ɵɵdomProperty(\"text\", \"Next\");\n            i0.ɵɵadvance();\n            i0.ɵɵdomProperty(\"ngIf\", ctx.errorMessage);\n          }\n        },\n        styles: [\"[_nghost-%COMP%]{display:block}h3[_ngcontent-%COMP%]{display:inline-block;position:relative;margin:20px 20px 40px;width:100%;text-align:center}form[_ngcontent-%COMP%]{display:grid;grid-row-gap:10px;max-width:800px;margin:0 auto}.field[_ngcontent-%COMP%]{display:grid;grid-template-columns:150px 1fr;margin:0 20px 15px}.field-error[_ngcontent-%COMP%]{grid-column:2;color:red;font-size:.75em;line-height:2em}input[_ngcontent-%COMP%], label[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{line-height:24pt}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:0 12px;-webkit-appearance:none;border:solid 1px #000;border-radius:0}select[_ngcontent-%COMP%]{padding:10px 12px}.error[_ngcontent-%COMP%]{color:red;text-align:center}kth-button[_ngcontent-%COMP%]{margin:0 auto}@media screen and (min-width:768px){h3[_ngcontent-%COMP%]{margin:20px auto 40px}}\"]\n      });\n    }\n  }\n  return ProcessBookingPayment;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}