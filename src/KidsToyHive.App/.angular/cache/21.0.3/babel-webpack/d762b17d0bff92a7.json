{"ast":null,"code":"var _a, _b, _c;\nimport { __decorate, __metadata } from \"tslib\";\n// Copyright (c) Quinntyne Brown. All Rights Reserved.\n// Licensed under the MIT License. See License.txt in the project root for license information.\nimport { Component } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { BookingService, AuthService } from '../../core';\nimport { LocalStorageService, accessTokenKey, bookingIdKey, productIdKey, isProblemDetails } from '../../core';\nimport { Router, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree } from '@angular/router';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { takeUntil, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nexport let ProcessPaymentSectionGuard = /*#__PURE__*/(() => {\n  class ProcessPaymentSectionGuard {\n    constructor(_localStorageService, _router) {\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n    }\n    canActivate(route, state) {\n      const bookingId = this._localStorageService.get({\n        name: 'bookingId'\n      });\n      const token = this._localStorageService.get({\n        name: accessTokenKey\n      });\n      if (!bookingId || !token) return this._router.parseUrl('order/step/2');\n      return true;\n    }\n    static {\n      this.ɵfac = function ProcessPaymentSectionGuard_Factory(__ngFactoryType__) {\n        i0.ɵɵinvalidFactory();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: ProcessPaymentSectionGuard,\n        factory: ProcessPaymentSectionGuard.ɵfac\n      });\n    }\n  }\n  return ProcessPaymentSectionGuard;\n})();\nlet ProcessBookingPayment = class ProcessBookingPayment {\n  constructor(_authService, _bookingService, _localStorageService, _router) {\n    this._authService = _authService;\n    this._bookingService = _bookingService;\n    this._localStorageService = _localStorageService;\n    this._router = _router;\n    this.onDestroy = new Subject();\n    this.form = new FormGroup({\n      number: new FormControl(null, [Validators.required]),\n      expYear: new FormControl(null, [Validators.required]),\n      expMonth: new FormControl(null, [Validators.required]),\n      cvc: new FormControl(null, [Validators.required])\n    });\n  }\n  ngOnInit() {\n    this._authService.isAuthenticatedChanged$.pipe(takeUntil(this.onDestroy), map(x => {\n      if (!x) {\n        this._router.navigateByUrl('order/step/1');\n      }\n    })).subscribe();\n  }\n  ngOnDestroy() {\n    this.onDestroy.next();\n  }\n  tryToCheckout(formValue) {\n    const bookingId = this._localStorageService.get({\n      name: bookingIdKey\n    });\n    this._bookingService.processBookingPayment({\n      number: formValue.number,\n      expMonth: formValue.expMonth,\n      expYear: formValue.expYear,\n      cvc: formValue.cvc,\n      bookingId\n    }).pipe(takeUntil(this.onDestroy), map(x => {\n      if (isProblemDetails(x)) {\n        this.errorMessage = x.detail;\n      } else {\n        this._localStorageService.remove({\n          name: bookingIdKey\n        });\n        this._localStorageService.remove({\n          name: productIdKey\n        });\n        this._router.navigateByUrl('myprofile');\n      }\n    })).subscribe();\n  }\n  get number() {\n    return this.form.get('number');\n  }\n  get expMonth() {\n    return this.form.get('expMonth');\n  }\n  get expYear() {\n    return this.form.get('expYear');\n  }\n  get cvc() {\n    return this.form.get('cvc');\n  }\n};\nProcessBookingPayment = __decorate([Component({\n  standalone: true,\n  templateUrl: './process-booking-payment.html',\n  styleUrls: ['./process-booking-payment.scss'],\n  selector: 'kth-process-booking-payment'\n}), __metadata(\"design:paramtypes\", [typeof (_a = typeof AuthService !== \"undefined\" && AuthService) === \"function\" ? _a : Object, typeof (_b = typeof BookingService !== \"undefined\" && BookingService) === \"function\" ? _b : Object, typeof (_c = typeof LocalStorageService !== \"undefined\" && LocalStorageService) === \"function\" ? _c : Object, Router])], ProcessBookingPayment);\nexport { ProcessBookingPayment };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}