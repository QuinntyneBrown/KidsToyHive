{"ast":null,"code":"import { __decorate, __metadata } from \"tslib\";\n// Copyright (c) Quinntyne Brown. All Rights Reserved.\n// Licensed under the MIT License. See License.txt in the project root for license information.\nimport { Component } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { CustomerService, AuthService } from '../../../../../core';\nimport { LocalStorageService, accessTokenKey, isProblemDetails } from '../../../../../core';\nimport { Router, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree } from '@angular/router';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { takeUntil, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../../core\";\nimport * as i2 from \"@angular/router\";\nexport let CreateCustomerSectionGuard = /*#__PURE__*/(() => {\n  class CreateCustomerSectionGuard {\n    constructor(_localStorageService, _router) {\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n    }\n    canActivate(route, state) {\n      const token = this._localStorageService.get({\n        name: accessTokenKey\n      });\n      const productId = this._localStorageService.get({\n        name: 'productId'\n      });\n      if (!productId) return this._router.parseUrl('toys');\n      if (token) return this._router.parseUrl('order/step/2');\n      return true;\n    }\n    static {\n      this.ɵfac = function CreateCustomerSectionGuard_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CreateCustomerSectionGuard)(i0.ɵɵinject(i1.LocalStorageService), i0.ɵɵinject(i2.Router));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: CreateCustomerSectionGuard,\n        factory: CreateCustomerSectionGuard.ɵfac\n      });\n    }\n  }\n  return CreateCustomerSectionGuard;\n})();\nlet CreateCustomerSection = class CreateCustomerSection {\n  constructor(_authService, _customerService, _localStorageService, _router) {\n    this._authService = _authService;\n    this._customerService = _customerService;\n    this._localStorageService = _localStorageService;\n    this._router = _router;\n    this.onDestroy = new Subject();\n    this.form = new FormGroup({\n      firstName: new FormControl(null, [Validators.required]),\n      lastName: new FormControl(null, [Validators.required]),\n      phoneNumber: new FormControl(null, [Validators.required]),\n      email: new FormControl(null, [Validators.required, Validators.email]),\n      acceptedTermsAndConditions: new FormControl(null, [Validators.required])\n    });\n  }\n  ngOnInit() {\n    this._localStorageService.changes$.pipe(takeUntil(this.onDestroy), map(x => {\n      if (this._localStorageService.get({\n        name: accessTokenKey\n      })) this._router.navigateByUrl('order/step/2');\n    })).subscribe();\n  }\n  tryToSaveCustomer(customer) {\n    if (this.form.valid) {\n      this._customerService.create({\n        customer,\n        acceptedTermsAndConditions: this.form.value.acceptedTermsAndConditions\n      }).pipe(takeUntil(this.onDestroy), map(x => {\n        if (isProblemDetails(x)) {\n          this.errorMessage = 'An account exist with this email. Sign in with the existing account.';\n        } else {\n          this._localStorageService.put({\n            name: accessTokenKey,\n            value: x.accessToken\n          });\n          this._router.navigateByUrl('/order/step/2');\n          this._authService.isAuthenticatedChanged$.next(true);\n        }\n      })).subscribe();\n    }\n  }\n  get firstName() {\n    return this.form.get('firstName');\n  }\n  get lastName() {\n    return this.form.get('lastName');\n  }\n  get email() {\n    return this.form.get('email');\n  }\n  get phoneNumber() {\n    return this.form.get('phoneNumber');\n  }\n  get acceptedTermsAndConditions() {\n    return this.form.get('acceptedTermsAndConditions');\n  }\n  ngOnDestroy() {\n    this.onDestroy.next();\n  }\n};\nCreateCustomerSection = __decorate([Component({\n  standalone: true,\n  templateUrl: './create-customer-section.html',\n  styleUrls: ['./create-customer-section.scss'],\n  selector: 'kth-create-customer-section'\n}), __metadata(\"design:paramtypes\", [AuthService, CustomerService, LocalStorageService, Router])], CreateCustomerSection);\nexport { CreateCustomerSection };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}