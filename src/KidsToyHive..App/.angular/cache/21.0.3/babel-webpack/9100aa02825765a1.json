{"ast":null,"code":"import { Subject } from 'rxjs';\nimport { BookingService, AuthService } from '../../../../../core';\nimport { LocalStorageService, accessTokenKey, bookingIdKey, isProblemDetails } from '../../../../../core';\nimport { Router, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree } from '@angular/router';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { takeUntil, map } from 'rxjs/operators';\nimport { YourOrderService } from '../../../your-order.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../../core\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../../your-order.service\";\nfunction CreateBookingSection_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" Date is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateBookingSection_option_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"option\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    const slot_r3 = ctx.$implicit;\n    i0.ɵɵdomProperty(\"value\", slot_r3.value);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", slot_r3.name, \" \");\n  }\n}\nfunction CreateBookingSection_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" Selected TimeSlot is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateBookingSection_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" Street is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateBookingSection_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" City is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateBookingSection_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" Province is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateBookingSection_div_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" Postal Code is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateBookingSection_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.errorMessage, \" \");\n  }\n}\nexport let CreateBookingSectionGuard = /*#__PURE__*/(() => {\n  class CreateBookingSectionGuard {\n    constructor(_localStorageService, _router) {\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n    }\n    canActivate(route, state) {\n      const bookingId = this._localStorageService.get({\n        name: bookingIdKey\n      });\n      const token = this._localStorageService.get({\n        name: accessTokenKey\n      });\n      if (!token) return this._router.parseUrl('order/step/1');\n      if (bookingId) return this._router.parseUrl('order/step/3');\n      return true;\n    }\n    static {\n      this.ɵfac = function CreateBookingSectionGuard_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CreateBookingSectionGuard)(i0.ɵɵinject(i1.LocalStorageService), i0.ɵɵinject(i2.Router));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: CreateBookingSectionGuard,\n        factory: CreateBookingSectionGuard.ɵfac\n      });\n    }\n  }\n  return CreateBookingSectionGuard;\n})();\nexport let CreateBookingSection = /*#__PURE__*/(() => {\n  class CreateBookingSection {\n    get _productId() {\n      return this._localStorageService.get({\n        name: 'productId'\n      });\n    }\n    constructor(_bookingService, _localStorageService, _router, _authService, _yourOrderService) {\n      this._bookingService = _bookingService;\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n      this._authService = _authService;\n      this._yourOrderService = _yourOrderService;\n      this.onDestroy = new Subject();\n      this.form = new FormGroup({\n        date: new FormControl(null, [Validators.required]),\n        bookingTimeSlot: new FormControl(null, [Validators.required]),\n        street: new FormControl(null, [Validators.required]),\n        city: new FormControl(null, [Validators.required]),\n        province: new FormControl(null, [Validators.required]),\n        postalCode: new FormControl(null, [Validators.required])\n      });\n      this.bookingTimeSlots = [{\n        value: 0,\n        name: 'Morning'\n      }, {\n        value: 1,\n        name: 'Afternoon'\n      }, {\n        value: 2,\n        name: 'Full Day'\n      }];\n    }\n    ngOnInit() {\n      this._yourOrderService.booking$.next({});\n      this._authService.isAuthenticatedChanged$.pipe(takeUntil(this.onDestroy), map(x => {\n        if (!x) {\n          this._router.navigateByUrl('order/step/1');\n        }\n      })).subscribe();\n    }\n    handleBookingTimeSlotChange() {\n      this._yourOrderService.bookingTimeSlot$.next(this.form.value.bookingTimeSlot);\n    }\n    handleBookingDateChange() {\n      this._yourOrderService.bookingDate$.next(this.form.value.date);\n    }\n    tryToCreateBooking(value) {\n      const booking = {\n        bookingDetails: [{\n          productId: this._productId,\n          quantity: 1\n        }],\n        date: value.date,\n        bookingTimeSlot: value.bookingTimeSlot,\n        location: {\n          address: {\n            street: value.street,\n            city: value.city,\n            province: value.province,\n            postalCode: value.postalCode\n          }\n        }\n      };\n      this._bookingService.create({\n        booking\n      }).pipe(takeUntil(this.onDestroy), map(x => {\n        if (isProblemDetails(x)) {\n          this.errorMessage = 'The Jungle Jumparro is unavaliable for the time and date you have selected';\n        } else {\n          this._localStorageService.put({\n            name: bookingIdKey,\n            value: x.bookingId\n          });\n          this._router.navigateByUrl('/order/step/3');\n        }\n      })).subscribe();\n    }\n    get date() {\n      return this.form.get('date');\n    }\n    get bookingTimeSlot() {\n      return this.form.get('bookingTimeSlot');\n    }\n    get street() {\n      return this.form.get('street');\n    }\n    get city() {\n      return this.form.get('city');\n    }\n    get province() {\n      return this.form.get('province');\n    }\n    get postalCode() {\n      return this.form.get('postalCode');\n    }\n    ngOnDestroy() {\n      this.onDestroy.next();\n    }\n    static {\n      this.ɵfac = function CreateBookingSection_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CreateBookingSection)(i0.ɵɵdirectiveInject(i1.BookingService), i0.ɵɵdirectiveInject(i1.LocalStorageService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i3.YourOrderService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CreateBookingSection,\n        selectors: [[\"kth-create-booking-section\"]],\n        decls: 38,\n        vars: 11,\n        consts: [[\"picker\", \"\"], [\"novalidate\", \"\", \"autocomplete\", \"off\", \"spellcheck\", \"false\", 3, \"formGroup\"], [1, \"field\"], [\"type\", \"text\", \"formControlName\", \"date\", 3, \"blur\", \"focus\", \"matDatepicker\"], [\"class\", \"field-error\", 4, \"ngIf\"], [\"formControlName\", \"bookingTimeSlot\", 3, \"change\", \"focus\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"text\", \"formControlName\", \"street\", 3, \"focus\"], [\"type\", \"text\", \"formControlName\", \"city\", 3, \"focus\"], [\"type\", \"text\", \"formControlName\", \"province\", 3, \"focus\"], [\"type\", \"text\", \"formControlName\", \"postalCode\", 3, \"focus\"], [3, \"click\", \"text\"], [4, \"ngIf\"], [1, \"field-error\"], [3, \"value\"]],\n        template: function CreateBookingSection_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵdomElementStart(0, \"h3\");\n            i0.ɵɵtext(1, \"When and Where Are We Delivering Your Toys?\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(2, \"form\", 1)(3, \"div\", 2)(4, \"label\");\n            i0.ɵɵtext(5, \"Date:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(6, \"input\", 3);\n            i0.ɵɵdomListener(\"blur\", function CreateBookingSection_Template_input_blur_6_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.handleBookingDateChange());\n            })(\"focus\", function CreateBookingSection_Template_input_focus_6_listener() {\n              i0.ɵɵrestoreView(_r1);\n              const picker_r2 = i0.ɵɵreference(8);\n              return i0.ɵɵresetView(picker_r2.open());\n            })(\"focus\", function CreateBookingSection_Template_input_focus_6_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.errorMessage = \"\");\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElement(7, \"mat-datepicker\", null, 0);\n            i0.ɵɵdomTemplate(9, CreateBookingSection_div_9_Template, 2, 0, \"div\", 4);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(10, \"div\", 2)(11, \"label\");\n            i0.ɵɵtext(12, \"Pick a Time Slot:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(13, \"select\", 5);\n            i0.ɵɵdomListener(\"change\", function CreateBookingSection_Template_select_change_13_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.handleBookingTimeSlotChange());\n            })(\"focus\", function CreateBookingSection_Template_select_focus_13_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.errorMessage = \"\");\n            });\n            i0.ɵɵdomTemplate(14, CreateBookingSection_option_14_Template, 2, 2, \"option\", 6);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(15, CreateBookingSection_div_15_Template, 2, 0, \"div\", 4);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(16, \"div\", 2)(17, \"label\");\n            i0.ɵɵtext(18, \"Street:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(19, \"input\", 7);\n            i0.ɵɵdomListener(\"focus\", function CreateBookingSection_Template_input_focus_19_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.errorMessage = \"\");\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(20, CreateBookingSection_div_20_Template, 2, 0, \"div\", 4);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(21, \"div\", 2)(22, \"label\");\n            i0.ɵɵtext(23, \"City:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(24, \"input\", 8);\n            i0.ɵɵdomListener(\"focus\", function CreateBookingSection_Template_input_focus_24_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.errorMessage = \"\");\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(25, CreateBookingSection_div_25_Template, 2, 0, \"div\", 4);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(26, \"div\", 2)(27, \"label\");\n            i0.ɵɵtext(28, \"Province:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(29, \"input\", 9);\n            i0.ɵɵdomListener(\"focus\", function CreateBookingSection_Template_input_focus_29_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.errorMessage = \"\");\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(30, CreateBookingSection_div_30_Template, 2, 0, \"div\", 4);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(31, \"div\", 2)(32, \"label\");\n            i0.ɵɵtext(33, \"Postal Code:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(34, \"input\", 10);\n            i0.ɵɵdomListener(\"focus\", function CreateBookingSection_Template_input_focus_34_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.errorMessage = \"\");\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(35, CreateBookingSection_div_35_Template, 2, 0, \"div\", 4);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(36, \"kth-button\", 11);\n            i0.ɵɵdomListener(\"click\", function CreateBookingSection_Template_kth_button_click_36_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.tryToCreateBooking(ctx.form.value));\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(37, CreateBookingSection_div_37_Template, 2, 1, \"div\", 12);\n            i0.ɵɵdomElementEnd();\n          }\n          if (rf & 2) {\n            const picker_r2 = i0.ɵɵreference(8);\n            i0.ɵɵadvance(2);\n            i0.ɵɵdomProperty(\"formGroup\", ctx.form);\n            i0.ɵɵadvance(4);\n            i0.ɵɵdomProperty(\"matDatepicker\", picker_r2);\n            i0.ɵɵadvance(3);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.date.errors && ctx.date.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngForOf\", ctx.bookingTimeSlots);\n            i0.ɵɵadvance();\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.bookingTimeSlot.errors && ctx.bookingTimeSlot.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.street.errors && ctx.street.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.city.errors && ctx.city.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.province.errors && ctx.province.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.postalCode.errors && ctx.postalCode.errors.required);\n            i0.ɵɵadvance();\n            i0.ɵɵdomProperty(\"text\", \"Next\");\n            i0.ɵɵadvance();\n            i0.ɵɵdomProperty(\"ngIf\", ctx.errorMessage);\n          }\n        },\n        styles: [\"[_nghost-%COMP%]{display:block}h3[_ngcontent-%COMP%]{display:inline-block;position:relative;margin:20px 20px 40px;width:100%;text-align:center}form[_ngcontent-%COMP%]{display:grid;grid-row-gap:10px;max-width:800px;margin:0 auto}.field[_ngcontent-%COMP%]{display:grid;grid-template-columns:150px 1fr;margin:0 20px 15px}.field-error[_ngcontent-%COMP%]{grid-column:2;color:red;font-size:.75em;line-height:2em}input[_ngcontent-%COMP%], label[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{line-height:24pt}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:0 12px;-webkit-appearance:none;border:solid 1px #000;border-radius:0}select[_ngcontent-%COMP%]{padding:10px 12px}kth-button[_ngcontent-%COMP%]{margin:0 auto}@media screen and (min-width:768px){h3[_ngcontent-%COMP%]{margin:20px auto 40px}}\"]\n      });\n    }\n  }\n  return CreateBookingSection;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}