{"ast":null,"code":"import { Subject } from 'rxjs';\nimport { CustomerService, AuthService } from '../../../../../core';\nimport { LocalStorageService, accessTokenKey, isProblemDetails } from '../../../../../core';\nimport { Router, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree } from '@angular/router';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { takeUntil, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../../core\";\nimport * as i2 from \"@angular/router\";\nfunction CreateCustomerSection_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 12);\n    i0.ɵɵtext(1, \" First Name is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateCustomerSection_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 12);\n    i0.ɵɵtext(1, \" Last Name is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateCustomerSection_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 12);\n    i0.ɵɵtext(1, \" Email is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateCustomerSection_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 12);\n    i0.ɵɵtext(1, \" Phone Number is required. \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateCustomerSection_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 12);\n    i0.ɵɵtext(1, \" Please Accept Terms and Conditions \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction CreateCustomerSection_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.errorMessage, \" \");\n  }\n}\nexport let CreateCustomerSectionGuard = /*#__PURE__*/(() => {\n  class CreateCustomerSectionGuard {\n    constructor(_localStorageService, _router) {\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n    }\n    canActivate(route, state) {\n      const token = this._localStorageService.get({\n        name: accessTokenKey\n      });\n      const productId = this._localStorageService.get({\n        name: 'productId'\n      });\n      if (!productId) return this._router.parseUrl('toys');\n      if (token) return this._router.parseUrl('order/step/2');\n      return true;\n    }\n    static {\n      this.ɵfac = function CreateCustomerSectionGuard_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CreateCustomerSectionGuard)(i0.ɵɵinject(i1.LocalStorageService), i0.ɵɵinject(i2.Router));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: CreateCustomerSectionGuard,\n        factory: CreateCustomerSectionGuard.ɵfac\n      });\n    }\n  }\n  return CreateCustomerSectionGuard;\n})();\nexport let CreateCustomerSection = /*#__PURE__*/(() => {\n  class CreateCustomerSection {\n    constructor(_authService, _customerService, _localStorageService, _router) {\n      this._authService = _authService;\n      this._customerService = _customerService;\n      this._localStorageService = _localStorageService;\n      this._router = _router;\n      this.onDestroy = new Subject();\n      this.form = new FormGroup({\n        firstName: new FormControl(null, [Validators.required]),\n        lastName: new FormControl(null, [Validators.required]),\n        phoneNumber: new FormControl(null, [Validators.required]),\n        email: new FormControl(null, [Validators.required, Validators.email]),\n        acceptedTermsAndConditions: new FormControl(null, [Validators.required])\n      });\n    }\n    ngOnInit() {\n      this._localStorageService.changes$.pipe(takeUntil(this.onDestroy), map(x => {\n        if (this._localStorageService.get({\n          name: accessTokenKey\n        })) this._router.navigateByUrl('order/step/2');\n      })).subscribe();\n    }\n    tryToSaveCustomer(customer) {\n      if (this.form.valid) {\n        this._customerService.create({\n          customer,\n          acceptedTermsAndConditions: this.form.value.acceptedTermsAndConditions\n        }).pipe(takeUntil(this.onDestroy), map(x => {\n          if (isProblemDetails(x)) {\n            this.errorMessage = 'An account exist with this email. Sign in with the existing account.';\n          } else {\n            this._localStorageService.put({\n              name: accessTokenKey,\n              value: x.accessToken\n            });\n            this._router.navigateByUrl('/order/step/2');\n            this._authService.isAuthenticatedChanged$.next(true);\n          }\n        })).subscribe();\n      }\n    }\n    get firstName() {\n      return this.form.get('firstName');\n    }\n    get lastName() {\n      return this.form.get('lastName');\n    }\n    get email() {\n      return this.form.get('email');\n    }\n    get phoneNumber() {\n      return this.form.get('phoneNumber');\n    }\n    get acceptedTermsAndConditions() {\n      return this.form.get('acceptedTermsAndConditions');\n    }\n    ngOnDestroy() {\n      this.onDestroy.next();\n    }\n    static {\n      this.ɵfac = function CreateCustomerSection_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CreateCustomerSection)(i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i1.CustomerService), i0.ɵɵdirectiveInject(i1.LocalStorageService), i0.ɵɵdirectiveInject(i2.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CreateCustomerSection,\n        selectors: [[\"kth-create-customer-section\"]],\n        decls: 30,\n        vars: 8,\n        consts: [[\"novalidate\", \"\", \"autocomplete\", \"off\", \"spellcheck\", \"false\", 3, \"formGroup\"], [1, \"field\"], [\"id\", \"firstName\", \"type\", \"text\", \"formControlName\", \"firstName\", \"required\", \"\"], [\"class\", \"field-error\", 4, \"ngIf\"], [\"type\", \"text\", \"formControlName\", \"lastName\"], [\"type\", \"text\", \"formControlName\", \"email\"], [\"type\", \"text\", \"formControlName\", \"phoneNumber\"], [1, \"checkbox\"], [\"id\", \"accept-terms-and-conditions-checkbox\", \"type\", \"checkbox\", \"formControlName\", \"acceptedTermsAndConditions\"], [\"for\", \"accept-terms-and-conditions-checkbox\"], [3, \"click\", \"text\"], [4, \"ngIf\"], [1, \"field-error\"]],\n        template: function CreateCustomerSection_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵdomElementStart(0, \"h3\");\n            i0.ɵɵtext(1, \"Create an Account So We Can Deliver You Your Toys\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(2, \"form\", 0)(3, \"div\", 1)(4, \"label\");\n            i0.ɵɵtext(5, \"First Name:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElement(6, \"input\", 2);\n            i0.ɵɵdomTemplate(7, CreateCustomerSection_div_7_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(8, \"div\", 1)(9, \"label\");\n            i0.ɵɵtext(10, \"Last Name:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElement(11, \"input\", 4);\n            i0.ɵɵdomTemplate(12, CreateCustomerSection_div_12_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(13, \"div\", 1)(14, \"label\");\n            i0.ɵɵtext(15, \"Email:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElement(16, \"input\", 5);\n            i0.ɵɵdomTemplate(17, CreateCustomerSection_div_17_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(18, \"div\", 1)(19, \"label\");\n            i0.ɵɵtext(20, \"Phone Number:\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElement(21, \"input\", 6);\n            i0.ɵɵdomTemplate(22, CreateCustomerSection_div_22_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(23, \"div\", 7);\n            i0.ɵɵdomElement(24, \"input\", 8);\n            i0.ɵɵdomElementStart(25, \"label\", 9);\n            i0.ɵɵtext(26, \"I have read and accept terms and conditions\");\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(27, CreateCustomerSection_div_27_Template, 2, 0, \"div\", 3);\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomElementStart(28, \"kth-button\", 10);\n            i0.ɵɵdomListener(\"click\", function CreateCustomerSection_Template_kth_button_click_28_listener() {\n              return ctx.tryToSaveCustomer(ctx.form.value);\n            });\n            i0.ɵɵdomElementEnd();\n            i0.ɵɵdomTemplate(29, CreateCustomerSection_div_29_Template, 2, 1, \"div\", 11);\n            i0.ɵɵdomElementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(2);\n            i0.ɵɵdomProperty(\"formGroup\", ctx.form);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.firstName.errors && ctx.firstName.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.lastName.errors && ctx.lastName.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.email.errors && ctx.email.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.phoneNumber.errors && ctx.phoneNumber.errors.required);\n            i0.ɵɵadvance(5);\n            i0.ɵɵdomProperty(\"ngIf\", !ctx.form.pristine && ctx.acceptedTermsAndConditions.errors && ctx.acceptedTermsAndConditions.errors.required);\n            i0.ɵɵadvance();\n            i0.ɵɵdomProperty(\"text\", \"Next\");\n            i0.ɵɵadvance();\n            i0.ɵɵdomProperty(\"ngIf\", ctx.errorMessage);\n          }\n        },\n        encapsulation: 2\n      });\n    }\n  }\n  return CreateCustomerSection;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}